# tstoml

Extract and manipulate parts of TOML files without touching the
formatting and comments in other parts.

## Installation

You can install the development version of tstoml from
[GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("gaborcsardi/tstoml")
```

## Documentation

See at
[`https://gaborcsardi.github.io/tstoml/`](https://gaborcsardi.github.io/tstoml/reference/index.html/)
and also in the installed package:
[`help(package = "tstoml")`](https://gaborcsardi.github.io/tstoml/reference).

## Quickstart

### Create a tstoml object

Create a tstoml object from a string:

``` r
txt <- r"(
# This is a TOML document

title = "TOML Example"

[owner]
name = "Tom Preston-Werner"
dob = 1979-05-27T07:32:00-08:00

[database]
enabled = true
ports = [ 8000, 8001, 8002 ]
data = [ ["delta", "phi"], [3.14] ]
temp_targets = { cpu = 79.5, case = 72.0 }

[servers]

[servers.alpha]
ip = "10.0.0.1"
role = "frontend"

[servers.beta]
ip = "10.0.0.2"
role = "backend"
)"
toml <- ts_parse_toml(text = txt)
```

Pretty print a tstoml object:

``` r
toml
```

    #> # toml (24 lines)
    #>  1 | 
    #>  2 | # This is a TOML document
    #>  3 | 
    #>  4 | title = "TOML Example"
    #>  5 | 
    #>  6 | [owner]
    #>  7 | name = "Tom Preston-Werner"
    #>  8 | dob = 1979-05-27T07:32:00-08:00
    #>  9 | 
    #> 10 | [database]
    #> ℹ 14 more lines
    #> ℹ Use `print(n = ...)` to see more lines

### Select elements in a tstoml object

``` r
ts_tree_select(toml, "owner")
```

    #> # toml (24 lines, 1 selected element)
    #>   ...
    #>    3  | 
    #>    4  | title = "TOML Example"
    #>    5  | 
    #> >  6  | [owner]
    #> >  7  | name = "Tom Preston-Werner"
    #> >  8  | dob = 1979-05-27T07:32:00-08:00
    #> >  9  | 
    #>   10  | [database]
    #>   11  | enabled = true
    #>   12  | ports = [ 8000, 8001, 8002 ]
    #>   ...

Select element(s) inside elements:

``` r
ts_tree_select(toml, "owner", "name")
```

    #> # toml (24 lines, 1 selected element)
    #>   ...
    #>    4  | title = "TOML Example"
    #>    5  | 
    #>    6  | [owner]
    #> >  7  | name = "Tom Preston-Werner"
    #>    8  | dob = 1979-05-27T07:32:00-08:00
    #>    9  | 
    #>   10  | [database]
    #>   ...

Select element(s) of an array:

``` r
ts_tree_select(toml, "database", "ports", 1:2)
```

    #> # toml (24 lines, 2 selected elements)
    #>   ...
    #>    9  | 
    #>   10  | [database]
    #>   11  | enabled = true
    #> > 12  | ports = [ 8000, 8001, 8002 ]
    #>   13  | data = [ ["delta", "phi"], [3.14] ]
    #>   14  | temp_targets = { cpu = 79.5, case = 72.0 }
    #>   15  | 
    #>   ...

Select multiple keys from a table:

``` r
ts_tree_select(toml, "owner", c("name", "dob"))
```

    #> # toml (24 lines, 2 selected elements)
    #>   ...
    #>    4  | title = "TOML Example"
    #>    5  | 
    #>    6  | [owner]
    #> >  7  | name = "Tom Preston-Werner"
    #> >  8  | dob = 1979-05-27T07:32:00-08:00
    #>    9  | 
    #>   10  | [database]
    #>   11  | enabled = true
    #>   ...

### Delete elements

Delete selected elements:

``` r
ts_tree_select(toml, "owner", "name") |> ts_tree_delete()
```

    #> # toml (22 lines)
    #>  1 | # This is a TOML document
    #>  2 | 
    #>  3 | title = "TOML Example"
    #>  4 | 
    #>  5 | [owner]
    #>  6 | dob = 1979-05-27T07:32:00-08:00
    #>  7 | 
    #>  8 | [database]
    #>  9 | enabled = true
    #> 10 | ports = [ 8000, 8001, 8002 ]
    #> ℹ 12 more lines
    #> ℹ Use `print(n = ...)` to see more lines

### Insert elements

Insert a key-value pair into the document:

``` r
ts_tree_insert(toml, key = "new_key", "new_value")
```

    #> # toml (25 lines)
    #>  1 | # This is a TOML document
    #>  2 | 
    #>  3 | title = "TOML Example"
    #>  4 | 
    #>  5 | 
    #>  6 | new_key = "new_value"
    #>  7 | [owner]
    #>  8 | name = "Tom Preston-Werner"
    #>  9 | dob = 1979-05-27T07:32:00-08:00
    #> 10 | 
    #> ℹ 15 more lines
    #> ℹ Use `print(n = ...)` to see more lines

Insert a key-value pair into a table:

``` r
ts_tree_select(toml, "owner") |> ts_tree_insert(key = "dpt", "Engineering")
```

    #> # toml (24 lines)
    #>  1 | # This is a TOML document
    #>  2 | 
    #>  3 | title = "TOML Example"
    #>  4 | 
    #>  5 | [owner]
    #>  6 | name = "Tom Preston-Werner"
    #>  7 | dob = 1979-05-27T07:32:00-08:00
    #>  8 | dpt = "Engineering"
    #>  9 | 
    #> 10 | [database]
    #> ℹ 14 more lines
    #> ℹ Use `print(n = ...)` to see more lines

Insert an element into an array:

``` r
ts_tree_select(toml, "database", "ports") |>
  ts_tree_insert(10000L) |>
  print(n = 100)
```

    #> # toml (23 lines)
    #>  1 | # This is a TOML document
    #>  2 | 
    #>  3 | title = "TOML Example"
    #>  4 | 
    #>  5 | [owner]
    #>  6 | name = "Tom Preston-Werner"
    #>  7 | dob = 1979-05-27T07:32:00-08:00
    #>  8 | 
    #>  9 | [database]
    #> 10 | enabled = true
    #> 11 | ports = [ 8000, 8001, 8002, 10000 ]
    #> 12 | data = [ ["delta", "phi"], [3.14] ]
    #> 13 | temp_targets = { cpu = 79.5, case = 72.0 }
    #> 14 | 
    #> 15 | [servers]
    #> 16 | 
    #> 17 | [servers.alpha]
    #> 18 | ip = "10.0.0.1"
    #> 19 | role = "frontend"
    #> 20 | 
    #> 21 | [servers.beta]
    #> 22 | ip = "10.0.0.2"
    #> 23 | role = "backend"

Insert a new table into the document:

``` r
ts_tree_insert(toml, key = "new_table", list(a = 1, b = 2)) |>
  print(n = 100)
```

    #> # toml (27 lines)
    #>  1 | # This is a TOML document
    #>  2 | 
    #>  3 | title = "TOML Example"
    #>  4 | 
    #>  5 | [owner]
    #>  6 | name = "Tom Preston-Werner"
    #>  7 | dob = 1979-05-27T07:32:00-08:00
    #>  8 | 
    #>  9 | [database]
    #> 10 | enabled = true
    #> 11 | ports = [ 8000, 8001, 8002 ]
    #> 12 | data = [ ["delta", "phi"], [3.14] ]
    #> 13 | temp_targets = { cpu = 79.5, case = 72.0 }
    #> 14 | 
    #> 15 | [servers]
    #> 16 | 
    #> 17 | [servers.alpha]
    #> 18 | ip = "10.0.0.1"
    #> 19 | role = "frontend"
    #> 20 | 
    #> 21 | [servers.beta]
    #> 22 | ip = "10.0.0.2"
    #> 23 | role = "backend"
    #> 24 | 
    #> 25 | [new_table]
    #> 26 | a = 1.0
    #> 27 | b = 2.0

Insert a new array of tables into the document:

``` r
ts_tree_insert(toml, key = "new_aot",
  list(list(x = 1), list(x = 2))) |>
  print(n = 100)
```

    #> # toml (29 lines)
    #>  1 | # This is a TOML document
    #>  2 | 
    #>  3 | title = "TOML Example"
    #>  4 | 
    #>  5 | [owner]
    #>  6 | name = "Tom Preston-Werner"
    #>  7 | dob = 1979-05-27T07:32:00-08:00
    #>  8 | 
    #>  9 | [database]
    #> 10 | enabled = true
    #> 11 | ports = [ 8000, 8001, 8002 ]
    #> 12 | data = [ ["delta", "phi"], [3.14] ]
    #> 13 | temp_targets = { cpu = 79.5, case = 72.0 }
    #> 14 | 
    #> 15 | [servers]
    #> 16 | 
    #> 17 | [servers.alpha]
    #> 18 | ip = "10.0.0.1"
    #> 19 | role = "frontend"
    #> 20 | 
    #> 21 | [servers.beta]
    #> 22 | ip = "10.0.0.2"
    #> 23 | role = "backend"
    #> 24 | 
    #> 25 | [[new_aot]]
    #> 26 | x = 1.0
    #> 27 | 
    #> 28 | [[new_aot]]
    #> 29 | x = 2.0

### Update elements

Update an existing element:

``` r
ts_tree_select(toml, "title") |> ts_tree_update("A New TOML Example")
```

    #> # toml (23 lines)
    #>  1 | # This is a TOML document
    #>  2 | 
    #>  3 | title = "A New TOML Example"
    #>  4 | 
    #>  5 | [owner]
    #>  6 | name = "Tom Preston-Werner"
    #>  7 | dob = 1979-05-27T07:32:00-08:00
    #>  8 | 
    #>  9 | [database]
    #> 10 | enabled = true
    #> ℹ 13 more lines
    #> ℹ Use `print(n = ...)` to see more lines

Update multiple elements at once:

``` r
ts_tree_select(toml, "servers", c("alpha", "beta"), "ip") |>
  ts_tree_update("192.168.1.23") |>
  print(n = 100)
```

    #> # toml (23 lines)
    #>  1 | # This is a TOML document
    #>  2 | 
    #>  3 | title = "TOML Example"
    #>  4 | 
    #>  5 | [owner]
    #>  6 | name = "Tom Preston-Werner"
    #>  7 | dob = 1979-05-27T07:32:00-08:00
    #>  8 | 
    #>  9 | [database]
    #> 10 | enabled = true
    #> 11 | ports = [ 8000, 8001, 8002 ]
    #> 12 | data = [ ["delta", "phi"], [3.14] ]
    #> 13 | temp_targets = { cpu = 79.5, case = 72.0 }
    #> 14 | 
    #> 15 | [servers]
    #> 16 | 
    #> 17 | [servers.alpha]
    #> 18 | ip = "192.168.1.23"
    #> 19 | role = "frontend"
    #> 20 | 
    #> 21 | [servers.beta]
    #> 22 | ip = "192.168.1.23"
    #> 23 | role = "backend"

# License

MIT © Posit Software, PBC

# Package index

## Quickstart

- See
  [quickstart](https://gaborcsardi.github.io/tstoml/reference/quickstart.md)
  for a quick demonstration of tstoml.
- See
  [`ts_serialize_toml()`](https://gaborcsardi.github.io/tstoml/reference/ts_serialize_toml.md)
  to create TOML from R.
- See
  [`ts_unserialize_toml()`](https://gaborcsardi.github.io/tstoml/reference/ts_unserialize_toml.md)
  to parse TOML into R.
- See
  [`ts_parse_toml()`](https://gaborcsardi.github.io/tstoml/reference/ts_parse_toml.md),
  `ts_tree_select()`, and `ts_tree_unserialize()` to parse parts of TOML
  into R.
- See
  [`ts_parse_toml()`](https://gaborcsardi.github.io/tstoml/reference/ts_parse_toml.md),
  `ts_tree_select()`, `ts_tree_format()`, and `ts_tree_write()` to
  format parts of a TOML file or string and save it to a file.
- See
  [`ts_parse_toml()`](https://gaborcsardi.github.io/tstoml/reference/ts_parse_toml.md),
  [`ts_read_toml()`](https://gaborcsardi.github.io/tstoml/reference/ts_parse_toml.md),
  `ts_tree_select()`, `ts_tree_delete()`, `ts_tree_insert()`,
  `ts_tree_update()`, and `ts_tree_write()` to edit a TOML file or
  string and save it to a file.

## Parsing

- [`ts_parse_toml()`](https://gaborcsardi.github.io/tstoml/reference/ts_parse_toml.md)
  [`ts_read_toml()`](https://gaborcsardi.github.io/tstoml/reference/ts_parse_toml.md)
  : Parse a TOML file or string into a ts_tree_toml object
- [`ts_language_toml()`](https://gaborcsardi.github.io/tstoml/reference/ts_language_toml.md)
  : TODO
- [`ts_tree_new()`](https://rdrr.io/pkg/ts/man/ts_tree_new.html) :
  Create tree-sitter tree from file or string (from ts)

## Selection

- [`ts_tree_select()`](https://gaborcsardi.github.io/tstoml/reference/ts_tree_select.tstoml.md)
  : Select parts of a TOML tree-sitter tree.

## Serialization

- [`ts_serialize_toml()`](https://gaborcsardi.github.io/tstoml/reference/ts_serialize_toml.md)
  [`ts_toml_table()`](https://gaborcsardi.github.io/tstoml/reference/ts_serialize_toml.md)
  [`ts_toml_inline_table()`](https://gaborcsardi.github.io/tstoml/reference/ts_serialize_toml.md)
  [`ts_toml_array()`](https://gaborcsardi.github.io/tstoml/reference/ts_serialize_toml.md)
  [`ts_toml_array_of_tables()`](https://gaborcsardi.github.io/tstoml/reference/ts_serialize_toml.md)
  : Serialize an R object to TOML
- [`ts_serialize_toml_value()`](https://gaborcsardi.github.io/tstoml/reference/ts_serialize_toml_value.md)
  : Serialize a TOML value
- [`ts_unserialize_toml()`](https://gaborcsardi.github.io/tstoml/reference/ts_unserialize_toml.md)
  : Unserialize TOML to R objects

## Formatting

- [`ts_format_toml()`](https://gaborcsardi.github.io/tstoml/reference/ts_format_toml.md)
  : Format a TOML file

## Utilities

- [`toml_example_text()`](https://gaborcsardi.github.io/tstoml/reference/toml_example_text.md)
  : Example TOML text

## Options

- [`tstoml_options`](https://gaborcsardi.github.io/tstoml/reference/tstoml_options.md)
  : tstoml options

